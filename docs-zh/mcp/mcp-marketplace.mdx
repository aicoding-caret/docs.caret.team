---
title: "MCP 简易指南"
description: "了解如何使用 MCP 市场发现、安装和配置 MCP 服务器，这些服务器通过附加工具和资源增强 Caret 的能力。"
---

## 什么是 MCP 服务器？

MCP 服务器是增强 Caret 能力的专门扩展。它们使 Caret 能够执行额外的任务，如获取网页、处理图像、访问 API 等等。

## MCP 市场演练

MCP 市场为数百个跨多个类别的 MCP 服务器提供一键安装体验。

### 1. 访问市场

-   在 Caret 中，单击顶部工具栏中的"扩展"按钮（方形图标）
-   MCP 市场将打开，按类别显示可用的服务器

### 2. 浏览并选择服务器

-   按类别浏览服务器（搜索、文件系统、浏览器自动化、研究数据等）
-   单击服务器以查看有关其功能和要求的详细信息

### 3. 安装和配置

-   单击所选服务器的安装按钮
-   如果服务器需要 API 密钥（大多数都需要），Caret 将引导您完成：
    -   在哪里获取 API 密钥
    -   如何安全地输入它
-   服务器将自动添加到您的 MCP 设置中

### 4. 验证安装

-   安装完成时，Caret 将显示确认
-   在 Caret 的 MCP 设置 UI 中检查服务器状态

### 5. 使用新服务器

-   成功安装后，Caret 将自动集成服务器的功能
-   您将在 Caret 的系统提示中看到新工具和资源可用
-   只需要求 Caret 使用新服务器的功能
-   示例："使用 Perplexity 搜索网络以获取最新的 React 更新"

**企业用户：** 如果您在企业环境中使用 Caret，请确保根据组织的安全策略获得安装第三方 MCP 服务器的权限。

## 幕后发生的事情

当您安装 MCP 服务器时，会自动发生几件事：

### 1. 安装过程

-   服务器代码被克隆/安装到 `/Users/<username>/Documents/Caret/MCP/`
-   安装依赖项
-   构建服务器（TypeScript/JavaScript 编译或 Python 包安装）

### 2. 配置

-   MCP 设置文件使用您的服务器配置更新
-   此文件位于：`/Users/<username>/Library/Application Support/Code/User/globalStorage/saoudrizwan.claude-dev/settings/cline_mcp_settings.json`
-   环境变量（如 API 密钥）被安全存储
-   服务器路径已注册

### 3. 服务器启动

-   Caret 检测配置更改
-   Caret 将您的服务器作为单独的进程启动
-   通过 stdio 或 HTTP 建立通信

### 4. 与 Caret 集成

-   您的服务器功能已添加到 Caret 的系统提示中
-   工具通过 `use_mcp_tool` 命令可用
-   资源通过 `access_mcp_resource` 命令可用
-   Caret 现在可以在用户提示时使用这些功能

## 故障排除

### 系统要求

确保您的系统满足这些要求：

-   **Node.js 18.x 或更新版本**
    -   通过运行检查：`node --version`
    -   从以下位置安装：https://nodejs.org/
    -   JavaScript/TypeScript 实现所需
-   **Python 3.10 或更新版本**
    -   通过运行检查：`python --version`
    -   从以下位置安装：https://python.org/
    -   注意：某些专门的实现可能需要 Python 3.11+
-   **UV 包管理器**
    -   用于依赖项隔离的现代 Python 包管理器
    -   使用以下命令安装：
        ```bash
        curl -LsSf https://astral.sh/uv/install.sh | sh
        ```
        或：`pip install uv`
    -   验证：`uv --version`

如果这些命令中的任何一个失败或显示旧版本，请在继续之前安装/更新！

### 常见安装问题

-   确保您的互联网连接稳定
-   检查您是否有安装新软件的必要权限
-   验证 API 密钥是否正确输入（如果需要）
-   在 MCP 设置 UI 中检查服务器状态以获取任何错误消息

### 如何删除 MCP 服务器

要完全删除有问题的 MCP 服务器：

1. 打开 MCP 设置文件：`/Users/<username>/Library/Application Support/Code/User/globalStorage/saoudrizwan.claude-dev/settings/cline_mcp_settings.json`
2. 从 `mcpServers` 对象中删除服务器的整个条目
3. 保存文件
4. 重新启动 Caret

### 我仍然遇到错误

如果您在使用 MCP 服务器时遇到错误，您可以尝试以下操作：

-   检查 MCP 设置文件是否有错误
-   使用 Claude Sonnet 模型进行安装
-   验证服务器文件的路径是否正确
-   确保设置了所有必需的环境变量
-   检查是否有其他进程正在使用同一端口（对于基于 HTTP 的服务器）
-   尝试删除并重新安装服务器（从 `cline_mcp_settings.json` 文件和 `/Users/<username>/Documents/Caret/MCP/` 目录中删除）
-   使用终端直接运行带参数的命令。这将允许您看到 Caret 看到的相同错误

## MCP 服务器规则

Caret 已经知道您的活动 MCP 服务器及其用途，但是当您启用了许多 MCP 服务器时，定义何时使用每个服务器可能很有用。

利用 `.agents/context` 文件或自定义指令通过基于关键字的触发器支持智能 MCP 服务器激活，使 Caret 的工具选择更加直观和上下文感知。

### MCP 规则的工作原理

MCP 规则将您连接的 MCP 服务器分组到功能类别中，并定义触发关键字，当在与 Caret 的对话中检测到这些关键字时，会自动激活它们。

```json
{
	"mcpRules": {
		"webInteraction": {
			"servers": ["firecrawl-mcp-server", "fetch-mcp"],
			"triggers": ["web", "scrape", "browse", "website"],
			"description": "用于网页浏览和抓取的工具"
		}
	}
}
```

### 配置结构

1. **类别**：分组相关服务器（例如，"webInteraction"、"mediaAndDesign"）
2. **服务器**：列出每个类别中的服务器名称
3. **触发器**：激活这些服务器的关键字
4. **描述**：人类可读的类别解释

### MCP 规则的好处

-   **上下文工具选择**：Caret 根据对话上下文选择适当的工具
-   **减少摩擦**：无需手动指定要使用的工具
-   **有组织的能力**：逻辑上分组相关工具和服务器
-   **优先级**：使用明确的优先级排序处理模糊情况

### 示例用法

当您编写"你能抓取这个网站吗？"时，Caret 检测"抓取"和"网站"作为触发器，自动选择与网页相关的 MCP 服务器。

对于诸如"苹果的股价是多少？"这样的金融任务，诸如"股票"和"价格"这样的关键字会触发与金融相关的服务器。

### 快速入门模板

```json
{
	"mcpRules": {
		"category1": {
			"servers": ["server-name-1", "server-name-2"],
			"triggers": ["keyword1", "keyword2", "phrase1", "phrase2"],
			"description": "这些工具的功能描述"
		},
		"category2": {
			"servers": ["server-name-3"],
			"triggers": ["keyword3", "keyword4", "phrase3"],
			"description": "这些工具的功能描述"
		},
		"category3": {
			"servers": ["server-name-4", "server-name-5"],
			"triggers": ["keyword5", "keyword6", "phrase4"],
			"description": "这些工具的功能描述"
		}
	},
	"defaultBehavior": {
		"priorityOrder": ["category1", "category2", "category3"],
		"fallbackBehavior": "询问用户哪个工具最合适"
	}
}
```

将此添加到您的 `.agents/context` 文件或自定义指令中，使 Caret 的 MCP 服务器选择更加直观和上下文感知。

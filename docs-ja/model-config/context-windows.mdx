---
title: "コンテキストウィンドウガイド"
description: "AIモデルのコンテキストウィンドウの理解と管理"
---

## コンテキストウィンドウとは?

コンテキストウィンドウは、AIモデルが一度に処理できる最大テキスト量です。モデルの「作業メモリ」だと考えると分かりやすく、会話やコードのどれだけを同時に参照できるかを決めます。

<Note>
**ポイント:** コンテキストウィンドウが大きいほど多くのコードベースを理解できますが、コストや応答時間が増える場合があります。
</Note>

## コンテキストウィンドウのサイズ

### クイックリファレンス

| サイズ | トークン | 目安の語数 | 利用ケース |
|------|--------|------------------|----------|
| **Small** | 8K-32K | 6,000-24,000 | 単一ファイル、簡単な修正 |
| **Medium** | 128K | ~96,000 | ほとんどの開発プロジェクト |
| **Large** | 200K | ~150,000 | 複雑なコードベース |
| **Extra Large** | 400K+ | ~300,000+ | アプリ全体 |
| **Massive** | 1M+ | ~750,000+ | 複数プロジェクト分析 |

### モデル別コンテキストウィンドウ

| モデル | コンテキストウィンドウ | 有効ウィンドウ* | 備考 |
|-------|---------------|------------------|-------|
| **Claude Sonnet 4.5** | 1M tokens | ~500K tokens | 大規模コンテキストでも品質良好 |
| **GPT-5** | 400K tokens | ~300K tokens | 3つのモードで性能変動 |
| **Gemini 2.5 Pro** | 1M+ tokens | ~600K tokens | 文書分析に強い |
| **DeepSeek V3** | 128K tokens | ~100K tokens | ほとんどの作業に最適 |
| **Qwen3 Coder** | 256K tokens | ~200K tokens | バランス型 |

*有効ウィンドウは品質が安定して維持される範囲です。

## コンテキストを効率的に管理する

### コンテキストに含まれるもの

1. **現在の会話** - すべてのチャットメッセージ
2. **ファイル内容** - 共有した/読まれたファイル
3. **ツール出力** - 実行したコマンドの結果
4. **システムプロンプト** - Caret の指示(比重は小さい)

### 最適化戦略

#### 1. 新機能は新しいタスクで開始
```
/new - 新しいタスクを開始してコンテキストを初期化
```

メリット:
- 最大コンテキストを確保
- 不要な履歴を削除
- モデルの集中度を向上

#### 2. @メンションを戦略的に使う
ファイル全体を含めるのではなく:
- `@filename.ts` 必要なファイルだけを含める
- 大きいファイルは検索で必要部分だけ
- 関数単位に絞って参照

#### 3. auto-compact を有効化
Caret は長い会話を自動で要約できます:
- 設定 → Features → Auto-compact
- 重要なコンテキストは保持
- トークン使用量を削減

## コンテキスト限界の警告

### 限界に達する兆候

| 兆候 | 意味 | 対応 |
|-------------|---------------|----------|
| **"Context window exceeded"** | ハード上限到達 | 新しいタスク開始 or auto-compact 有効化 |
| **応答速度低下** | コンテキスト過負荷 | 取り込むファイルを減らす |
| **繰り返し提案** | コンテキスト分断 | 要約後に新しいタスク |
| **最新変更の欠落** | コンテキスト溢れ | チェックポイント活用 |

### プロジェクト規模別の推奨

#### 小規模プロジェクト (< 50 files)
- 多くのモデルで十分
- 必要ファイルは自由に含める
- 特別な最適化は不要

#### 中規模プロジェクト (50-500 files)
- 128K+ モデル推奨
- 作業中ファイルのみを含める
- 機能単位でコンテキスト整理

#### 大規模プロジェクト (500+ files)
- 200K+ モデル推奨
- モジュール単位で集中
- 全ファイルではなく検索を活用
- 作業を段階的に分割

## 高度なコンテキスト管理

### Plan/Act モード最適化

Plan/Act モードでコンテキストを効率配分できます:
- **Plan モード**: 低コストモデルで議論
- **Act モード**: 高性能モデルで実装

例:
```
Plan Mode: DeepSeek V3 (128K) - 低コスト計画
Act Mode: Claude Sonnet 4.5 (1M) - 最大コンテキスト実装
```

### コンテキスト・プルーニング戦略

1. **Temporal Pruning**: 古い会話を削除
2. **Semantic Pruning**: 関連のないコードを削除
3. **Hierarchical Pruning**: 大枠を残して詳細を削減

### トークン計算のヒント

#### ざっくり計算
- **1トークン ≈ 0.75語**
- **1トークン ≈ 4文字**
- **コード100行 ≈ 500-1000トークン**

#### ファイルサイズ基準
| ファイル種別 | KBあたりのトークン |
|-----------|---------------|
| **コード** | ~250-400 |
| **JSON** | ~300-500 |
| **Markdown** | ~200-300 |
| **Plain text** | ~200-250 |

## コンテキストウィンドウ FAQ

### Q: 会話が長くなると品質が落ちるのはなぜ?
**A:** モデルは過度なコンテキストで集中力を失います。通常、有効ウィンドウは最大値の50-70%程度です。

### Q: 最大のコンテキストウィンドウを使えば常に良い?
**A:** いいえ。大きいコンテキストはコスト増や応答品質低下の可能性があります。タスク規模に合わせて選びましょう。

### Q: コンテキスト使用量はどう確認する?
**A:** Caret UI でトークン使用量を表示します。コンテキストメーターが上限に近づいていないか確認してください。

### Q: 上限を超えるとどうなる?
**A:** Caret は次のいずれかで対応します:
- 自動で会話を圧縮(auto-compact)
- エラーメッセージとともに新しいタスクを推奨
- 古いメッセージの一部を削除(警告あり)

## 用途別おすすめ

| 用途 | 推奨コンテキスト | モデルおすすめ |
|----------|-------------------|------------------|
| **簡単な修正** | 32K-128K | DeepSeek V3 |
| **機能開発** | 128K-200K | Qwen3 Coder |
| **大規模リファクタリング** | 400K+ | Claude Sonnet 4.5 |
| **コードレビュー** | 200K-400K | GPT-5 |
| **ドキュメント作成** | 128K | 低コストモデル |
